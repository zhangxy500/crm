<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.neusoft.news.mapper.NewsMapper">

    <resultMap type="news" id="newsResultMap">
        <id column="newsId" property="newsId"/>
        <result column="newsTitle" property="newsTitle"/>
        <result column="newsContent" property="newsContent"/>
        <result column="createTime" property="createTime"/>
        <result column="newsTypeId" property="newsTypeId"/>
        <association property="newsType" javaType="newsType">
            <id column="ntnewsTypeId" property="newsTypeId"/>
            <result column="ntnewsTypeExplain" property="newsTypeExplain"/>
            <result column="ntnewsTypeName" property="newsTypeName"/>
            <result column="ntcreateTime" property="createTime"/>
        </association>
    </resultMap>

    <select id="selectNewsAll" resultMap="newsResultMap">
        select n.*,
               nt.newsTypeId ntnewsTypeId,
               nt.newsTypeName ntnewsTypeName,
               nt.newsTypeExplain ntnewsTypeExplain,
               nt.createTime ntcreateTime
        from news n left join newstype nt
        on n.newstypeid=nt.newstypeid
        order by n.newsid
    </select>
    
    <update id="updateNews" parameterType="news">
        update news
        set newsTitle=#{newsTitle},
            newsContent=#{newsContent},
            createTime=#{createTime},
            newsTypeId=#{newsTypeId}
        where newsId=#{newsId}
    </update>
    
    <select id="selectNewsCount" parameterType="news" resultType="int">
        select count(*) from news
        <where>
            <if test="newsTitle!=null and newsTitle!=''">
                and newsTitle like concat('%',#{newsTitle},'%')
            </if>
            <if test="newsContent!=null and newsContent!=''">
                and newsContent like concat('%',#{newsContent},'%')
            </if>
        </where>
    </select>
    
    <select id="selectNewsPaging" parameterType="news" resultMap="newsResultMap">
        select n.*,
               nt.newsTypeId ntnewsTypeId,
               nt.newsTypeName ntnewsTypeName,
               nt.newsTypeExplain ntnewsTypeExplain,
               nt.createTime ntcreateTime
        from news n left join newstype nt
        on n.newstypeid=nt.newstypeid
        <where>
            <if test="newsTitle!=null and newsTitle!=''">
                and n.newsTitle like concat('%',#{newsTitle},'%')
            </if>
            <if test="newsContent!=null and newsContent!=''">
                and n.newsContent like concat('%',#{newsContent},'%')
            </if>
        </where>
        order by n.newsid desc
        limit #{beginNum},#{maxPageNum}
    </select>
    
    <delete id="deleteNewsBatch" parameterType="int">
        delete from news where newsid in(
        <foreach collection="array" item="newsId" separator=",">
            #{newsId}
        </foreach>
        )
    </delete>
  
</mapper>